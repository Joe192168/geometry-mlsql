<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.geominfo.mlsql.mapper.AuthMapper">
    <select id="fetchAuth" resultType="com.geominfo.mlsql.domain.vo.MLSQLAuthTable">
        select
        mlsqlGroup.name as teamName,
        roleGroup.name as roleName,
        mlsqlTable.db,
        mlsqlTable.name as tableName,
        mlsqlTable.table_type,
        mlsqlTable.source_type,
        roleAuth.operate_type
        from mlsql_user user
        join mlsql_role_member roleMember on user.id=roleMember.mlsql_user_id
        join mlsql_group_role roleGroup on roleMember.mlsql_group_role_id=roleGroup.id
        join mlsql_group mlsqlGroup on mlsqlGroup.id=roleGroup.mlsql_group_id
        join mlsql_group_role_auth roleAuth on roleMember.mlsql_group_role_id=roleAuth.mlsql_group_role_id
        join mlsql_table mlsqlTable on roleAuth.mlsql_table_id=mlsqlTable.id
        join mlsql_group_table tableGroup on roleAuth.mlsql_table_id=tableGroup.mlsql_table_id and  roleGroup.mlsql_group_id=tableGroup.mlsql_group_id
        where user.name=#{name}
    </select>
</mapper>